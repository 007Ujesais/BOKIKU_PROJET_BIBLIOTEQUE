<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bienvenue Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .circle:hover {
            background-color: #3b82f6;
            color: white;
        }
        .active {
            background-color: #2563eb;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Bienvenue <span th:text="${nom}">Admin</span></h1>

        <!-- Error Message -->
        <div th:if="${error}" class="bg-red-100 text-red-700 p-4 rounded mb-6" th:text="${error}"></div>

        <!-- Navigation Circles -->
        <div class="flex space-x-4 mb-6">
            <div id="empruntsCircle" 
                 th:classappend="${view == 'emprunts'} ? 'active' : ''" 
                 class="circle bg-blue-200 text-blue-800 font-semibold" 
                 onclick="showSection('emprunts')">
                Emprunts
            </div>
            <div id="reservationsCircle" 
                 th:classappend="${view == 'reservations'} ? 'active' : ''" 
                 class="circle bg-blue-200 text-blue-800 font-semibold" 
                 onclick="showSection('reservations')">
                Réservations
            </div>
        </div>

        <!-- Emprunts Section -->
        <div id="empruntsSection" th:class="${view == 'emprunts'} ? '' : 'hidden'" class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Liste des Emprunts</h2>
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border p-2">Adhérent</th>
                        <th class="border p-2">Livre</th>
                        <th class="border p-2">Date d'emprunt</th>
                        <th class="border p-2">Date de retour prévue</th>
                        <th class="border p-2">Date de retour réelle</th>
                        <th class="border p-2">Prolongations</th>
                        <th class="border p-2">Statut</th>
                        <th class="border p-2">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="emprunt : ${emprunts}" th:class="${emprunt.status == 'EN_ATTENTE'} ? 'bg-yellow-100' : ''">
                        <td class="border p-2" th:text="${emprunt.adherent.nom}">Adhérent</td>
                        <td class="border p-2" th:text="${emprunt.livre.titre}">Livre</td>
                        <td class="border p-2" th:text="${emprunt.dateEmprunt}">Date Emprunt</td>
                        <td class="border p-2" th:text="${emprunt.dateRetourPrevue}">Date Retour Prévue</td>
                        <td class="border p-2" th:text="${emprunt.dateRetourReelle} ?: 'Non retourné'">Date Retour Réelle</td>
                        <td class="border p-2" th:text="${emprunt.prolongations}">Prolongations</td>
                        <td class="border p-2" th:text="${emprunt.status}">Statut</td>
                        <td class="border p-2">
                            <form th:action="@{/admin/emprunts/update-status}" method="post" class="inline">
                                <input type="hidden" name="id" th:value="${emprunt.id}">
                                <button type="submit" name="status" value="VALIDER" 
                                        th:disabled="${emprunt.status != 'EN_ATTENTE'}" 
                                        class="bg-green-500 text-white px-2 py-1 rounded disabled:bg-gray-400">
                                    Valider
                                </button>
                            </form>
                            <form th:action="@{/admin/emprunts/update-status}" method="post" class="inline">
                                <input type="hidden" name="id" th:value="${emprunt.id}">
                                <button type="submit" name="status" value="REFUSER" 
                                        th:disabled="${emprunt.status != 'EN_ATTENTE'}" 
                                        class="bg-red-500 text-white px-2 py-1 rounded disabled:bg-gray-400">
                                    Refuser
                                </button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Reservations Section -->
        <div id="reservationsSection" th:class="${view == 'reservations'} ? '' : 'hidden'" class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Liste des Réservations</h2>
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border p-2">Adhérent</th>
                        <th class="border p-2">Livre</th>
                        <th class="border p-2">Date de réservation</th>
                        <th class="border p-2">Statut</th>
                        <th class="border p-2">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="reservation : ${reservations}" th:class="${reservation.status == 'EN_ATTENTE'} ? 'bg-yellow-100' : ''">
                        <td class="border p-2" th:text="${reservation.adherent.nom}">Adhérent</td>
                        <td class="border p-2" th:text="${reservation.livre.titre}">Livre</td>
                        <td class="border p-2" th:text="${reservation.dateReservation}">Date Réservation</td>
                        <td class="border p-2" th:text="${reservation.status}">Statut</td>
                        <td class="border p-2">
                            <form th:action="@{/admin/reservations/update-status}" method="post" class="inline">
                                <input type="hidden" name="id" th:value="${reservation.id}">
                                <button type="submit" name="status" value="VALIDER" 
                                        th:disabled="${reservation.status != 'EN_ATTENTE'}" 
                                        class="bg-green-500 text-white px-2 py-1 rounded disabled:bg-gray-400">
                                    Valider
                                </button>
                            </form>
                            <form th:action="@{/admin/reservations/update-status}" method="post" class="inline">
                                <input type="hidden" name="id" th:value="${reservation.id}">
                                <button type="submit" name="status" value="REFUSER" 
                                        th:disabled="${reservation.status != 'EN_ATTENTE'}" 
                                        class="bg-red-500 text-white px-2 py-1 rounded disabled:bg-gray-400">
                                    Refuser
                                </button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function showSection(section) {
            const empruntsSection = document.getElementById('empruntsSection');
            const reservationsSection = document.getElementById('reservationsSection');
            const empruntsCircle = document.getElementById('empruntsCircle');
            const reservationsCircle = document.getElementById('reservationsCircle');

            if (section === 'emprunts') {
                empruntsSection.classList.remove('hidden');
                reservationsSection.classList.add('hidden');
                empruntsCircle.classList.add('active');
                reservationsCircle.classList.remove('active');
            } else {
                empruntsSection.classList.add('hidden');
                reservationsSection.classList.remove('hidden');
                empruntsCircle.classList.remove('active');
                reservationsCircle.classList.add('active');
            }
        }

        // Set initial section based on server-side view
        document.addEventListener('DOMContentLoaded', () => {
            showSection('[[${view}]]' || 'emprunts');
        });
    </script>
</body>
</html>